---
- name: Deployment K8s namespace and pods
  hosts: all
  gather_facts: no
  connection: local
  vars:
    web-namespace: nginx
    app: nginx
    image: nginx:1.19.9-alpine

  tasks:
    - name: Create a k8s namespace
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: "{{ web-namespace }}"
            labels:
              app: "{{ web-namespace }}"

    - name: Create k8s pod for nginx
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Pod
          metadata:
            name: "{{ app }}"
            namespace: "{{ web-namespace }}"
            labels:
              app: "{{ app }}"
          spec:
            containers:
              - name: "{{ app }}"
                image: "{{ image }}"
                imagePullPolicy: Always